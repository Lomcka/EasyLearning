<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="mod_fold_style.css">
    <style>

        /* Стили для модуля */
        .module-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .module-header h2 {
            margin: 0;
            font-size: 24px;
        }

        .module-card {
            background-color: #f2f2f2;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .module-card h3 {
            margin: 0;
            font-size: 18px;
        }

        .module-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .module-card li {
            padding: 5px 0;
            border-bottom: 1px solid #ccc;
        }

        .module-card li:last-child {
            border-bottom: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            border-radius: 5px;
            position: relative;
        }

    </style>
    <title>Главная</title>
</head>
<body>

<div class="nav">
    <h2>Ваши папки и модули
        <a href="settings.html"><img src="src/gear_icon.png" alt="Настройки" width="40" height="40"
                                     style="float: right;"></a>
    </h2>
</div>

<div class="content">
    <div class="modules">
        <h2>Модули</h2>
        <div id="modules-container"></div>
    </div>

    <div class="folders">
        <h2>Папки</h2>
        <div id="folders-container"></div>
    </div>
</div>

<!-- Кнопка создания модуля -->

<div class="buttons-container">
    <button id="create-module-button" onclick="showModal('add-module-modal')">Добавить модуль</button>

    <!-- Кнопка создания папки -->
    <button id="create-folder-button" onclick="showModal('add-folder-modal')">Создать папку</button>

    <!-- Кнопка объединения модулей -->
    <button id="merge-modules-button" onclick="showModal('merge-modules-modal')">Объединить модули</button>

    <!-- Кнопка объединения папок -->
    <button id="merge-folders-button" onclick="showModal('merge-folders-modal')">Объединить папки</button>
</div>

<script>
    function showModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.style.display = "block";
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.style.display = 'none';
    }
</script>

<!-- Модальное окно для добавления нового модуля -->
<div id="add-module-modal" class="modal">
    <div class="modal-content">
        <button class="close-button" onclick="closeModal('add-module-modal')">&times;</button>
        <h2>Добавление нового модуля</h2>
        <label for="module-name-input">
            <input type="text" id="module-name-input" placeholder="Введите имя нового модуля">
        </label>
        <button id="add-module-confirm-button">Добавить</button>
    </div>
</div>

<!-- Модальное окно для объединения модулей -->
<div id="merge-modules-modal" class="modal">
    <div class="modal-content">
        <button class="close-button" onclick="closeModal('merge-modules-modal')">&times;</button>
        <h2>Объединение модулей</h2>
        <p>Введите имена модулей через запятую:</p>
        <label for="module-names-input">
            <input type="text" id="module-names-input" placeholder="Имена модулей">
        </label>
        <p>Введите имя нового модуля:</p>
        <label for="new-module-name-input">
            <input type="text" id="new-module-name-input" placeholder="Имя нового модуля">
        </label>
        <button id="merge-modules-confirm-button">Объединить</button>
    </div>
</div>

<!-- Модальное окно для добавления новой папки -->
<div id="add-folder-modal" class="modal">
    <div class="modal-content">
        <button class="close-button" onclick="closeModal('add-folder-modal')">&times;</button>
        <h2>Добавление новой папки</h2>
        <label for="folder-name-input">
            <input type="text" id="folder-name-input" placeholder="Введите имя новой папки">
        </label>
        <button id="add-folder-confirm-button">Добавить</button>
    </div>
</div>

<!-- Модальное окно для объединения папок -->
<div id="merge-folders-modal" class="modal">
    <div class="modal-content">
        <button class="close-button" onclick="closeModal('merge-folders-modal')">&times;</button>
        <h2>Объединение папок</h2>
        <p>Введите имена папок через запятую:</p>
        <label for="folder-names-input">
            <input type="text" id="folder-names-input" placeholder="Имена папок">
        </label>
        <p>Введите имя новой папки:</p>
        <label for="new-folder-name-input">
            <input type="text" id="new-folder-name-input" placeholder="Имя новой папки">
        </label>
        <button id="merge-folders-confirm-button">Объединить</button>
    </div>
</div>

<script>
    const modulesContainer = document.getElementById('modules-container');
    const foldersContainer = document.getElementById('folders-container');

    // Загрузка модулей и папок с сервера
    function loadModulesAndFolders() {
        fetch('http://localhost:8070/EasyLearning?' + new URLSearchParams({
                'queryType': 'get-modules-and-folders'
            }))
            .then(response => response.json())
            .then(data => {
                createModuleButtons(data.modules);
                createFolderButtons(data.folders);
            })
            .catch(error => {
               console.error('Error:', error);
            });
    }

    // Для тестирования
    /*function loadModulesAndFolders() {
        const res = {
            'modules': [
                {
                    'name': 'MODULE'
                },
                {
                    'name': 'MOOOD'
                }
            ],
            'folders': [
                {
                    'name': 'FOLDERS'
                }
            ]
        };
        createModuleButtons(res.modules);
        createFolderButtons(res.folders);
    }*/

    // Создание кнопок для модулей
    function createModuleButtons(modules) {
        modulesContainer.innerHTML = '';

        modules.forEach(module => {
            const button = document.createElement('button');
            button.textContent = module.name;
            button.classList.add('button-link');

            button.addEventListener('click', () => {
                const urlParams = new URLSearchParams();
                urlParams.append('module', module.name);
                window.location.href = `modules.html?${urlParams.toString()}`;
            });

            modulesContainer.appendChild(button);
        });
    }

    // Создание кнопок для папок
    function createFolderButtons(folders) {
        foldersContainer.innerHTML = '';

        folders.forEach(folder => {
            const button = document.createElement('button');
            button.textContent = folder.name;
            button.classList.add('button-link');

            button.addEventListener('click', () => {
                const urlParams = new URLSearchParams();
                urlParams.append('folder', folder.name);
                window.location.href = `folder.html?${urlParams.toString()}`;
            });

            foldersContainer.appendChild(button);
        });
    }

    // Открытие модального окна для добавления нового модуля
    const addModuleModal = document.getElementById('add-module-modal');
    const addModuleConfirmButton = document.getElementById('add-module-confirm-button');
    const createModuleButton = document.getElementById('create-module-button');

    createModuleButton.addEventListener('click', () => {
        addModuleModal.style.display = "block";
    });

    addModuleConfirmButton.addEventListener('click', () => {
        const moduleNameInput = document.getElementById('module-name-input');

        fetch('http://localhost:8070/EasyLearning?' + new URLSearchParams({
            'queryType': 'add-new-module'
        }), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({'moduleName': moduleNameInput.value})
        })
            .then(response => response.json())
            .then(data => {
                closeModal('add-module-modal');
                loadModulesAndFolders();
            })
            .catch(error => {
                console.error('Error:', error);
            });

        addModuleModal.style.display = "none";
        moduleNameInput.value = '';
    });

    // Открытие модального окна для объединения модулей
    const mergeModulesModal = document.getElementById('merge-modules-modal');
    const mergeModulesConfirmButton = document.getElementById('merge-modules-confirm-button');
    const mergeModulesButton = document.getElementById('merge-modules-button');

    mergeModulesButton.addEventListener('click', () => {
        mergeModulesModal.style.display = "block";
    });

    mergeModulesConfirmButton.addEventListener('click', () => {
        const moduleNamesInput = document.getElementById('module-names-input');
        const newModuleNameInput = document.getElementById('new-module-name-input');

        const moduleNames = moduleNamesInput.value.split(',');
        const modules = moduleNames.map(name => ({name}));

        fetch('http://localhost:8070/EasyLearning/module/${newModuleNameInput.value}/merge?' + new URLSearchParams({
            'queryType': 'merge-modules'
        }), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(modules)
        })
            .then(response => response.json())
            .then(data => {
                closeModal('merge-modules-modal');
                loadModulesAndFolders();
            })
            .catch(error => {
                console.error('Error:', error);
            });

        mergeModulesModal.style.display = "none";
        moduleNamesInput.value = '';
        newModuleNameInput.value = '';
    });

    // Открытие модального окна для добавления новой папки
    const addFolderModal = document.getElementById('add-folder-modal');
    const addFolderConfirmButton = document.getElementById('add-folder-confirm-button');
    const createFolderButton = document.getElementById('create-folder-button');

    createFolderButton.addEventListener('click', () => {
        addFolderModal.style.display = "block";
    });

    addFolderConfirmButton.addEventListener('click', () => {
        const folderNameInput = document.getElementById('folder-name-input');

        fetch('http://localhost:8070/EasyLearning?' + new URLSearchParams({
            'queryType': 'add-new-folder'
        }), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({folderName: folderNameInput.value})
        })
            .then(response => response.json())
            .then(data => {
                closeModal('add-folder-modal');
                loadModulesAndFolders();
            })
            .catch(error => {
                console.error('Error:', error);
            });

        addFolderModal.style.display = "none";
        folderNameInput.value = '';
    });

    // Открытие модального окна для объединения папок
    const mergeFoldersModal = document.getElementById('merge-folders-modal');
    const mergeFoldersConfirmButton = document.getElementById('merge-folders-confirm-button');
    const mergeFoldersButton = document.getElementById('merge-folders-button');

    mergeFoldersButton.addEventListener('click', () => {
        mergeFoldersModal.style.display = "block";
    });

    mergeFoldersConfirmButton.addEventListener('click', () => {
        const folderNamesInput = document.getElementById('folder-names-input');
        const newFolderNameInput = document.getElementById('new-folder-name-input');

        const folderNames = folderNamesInput.value.split(',');
        const folders = folderNames.map(name => ({name}));

        fetch('http://localhost:8070/EasyLearning//folder/${newFolderNameInput.value}/merge?' + new URLSearchParams({
            'queryType': 'merge-folders'
        }), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(folders)
        })
            .then(response => response.json())
            .then(data => {
                closeModal('merge-folders-modal');
                loadModulesAndFolders();
            })
            .catch(error => {
                console.error('Error:', error);
            });

        mergeFoldersModal.style.display = "none";
        folderNamesInput.value = '';
        newFolderNameInput.value = '';
    });

    // Закрытие модальных окон
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.style.display = 'none';
    }

    document.querySelectorAll('.modal-close').forEach(button => {
        button.addEventListener('click', () => {
            const modal = button.closest('.modal');
            modal.style.display = 'none';
        });
    });

    // Загрузка модулей и папок при загрузке страницы
    loadModulesAndFolders();
</script>

</body>
</html>